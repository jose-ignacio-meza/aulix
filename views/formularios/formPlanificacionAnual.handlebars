<form method="POST" action="/formularios/enviar-planificacion-anual">
  <h2 style="text-align:center;">Formulario: Planificación Anual</h2>

  <!-- Datos iniciales -->
  <label for="nombre">Nombre</label>
  <input type="text" id="nombre" name="nombre" value="{{datos.usuario.datosPersonales.nombre}}">

  <label for="apellido">Apellido</label>
  <input type="text" id="apellido" name="apellido" value="{{datos.usuario.datosPersonales.apellido}}">

  <label for="dni">DNI</label>
  <input type="text" id="dni" name="dni" value="{{datos.usuario.datosPersonales.dni}}">

  <label for="institucion">Institución</label>
  <input type="text" id="institucion" name="institucion" value="{{datos.usuario.institucion}}">

  <label for="cursoGlobal">Curso/Área</label>
  <input type="text" id="cursoGlobal" name="cursoGlobal" value="{{datos.usuario.curso}}">

  <label for="anio">Año Lectivo</label>
  <input type="text" id="anio" name="anio" value="{{datos.respuestas.anio}}" placeholder="Ej: 2025">

  <!-- Cursos dinámicos -->
  <div id="cursos-container"></div>

  <button type="button" id="add-curso" class="btn" style="margin-top:1rem;">Agregar curso/sala</button>
  <button type="submit" class="btn" style="margin-top:1rem;background:green;">Guardar y Continuar</button>
</form>

<script>
  const cursosContainer = document.getElementById('cursos-container');
  const addCursoBtn = document.getElementById('add-curso');

  // Meses por trimestre
  const mesesPorTrimestre = {
    "1": ["Marzo", "Abril", "Mayo"],
    "2": ["Junio", "Julio", "Agosto"],
    "3": ["Septiembre", "Octubre", "Noviembre"]
  };

  let cursoIndex = 0;

  addCursoBtn.addEventListener('click', () => {
    const index = cursoIndex++;
    const cursoDiv = document.createElement('div');
    cursoDiv.classList.add('curso-block');
    cursoDiv.style.border = "1px solid #ccc";
    cursoDiv.style.padding = "1rem";
    cursoDiv.style.marginTop = "1rem";
    cursoDiv.style.borderRadius = "8px";

    cursoDiv.innerHTML = `
      <h3>Curso/Sala ${index + 1}</h3>
      <label>Trimestre</label>
      <select name="cursos[${index}][trimestre]" class="trimestre-select" data-index="${index}">
        <option value="">-- Seleccionar --</option>
        <option value="1">1° Trimestre</option>
        <option value="2">2° Trimestre</option>
        <option value="3">3° Trimestre</option>
      </select>
      <div class="meses-container" id="meses-${index}"></div>
    `;

    cursosContainer.appendChild(cursoDiv);

    const trimestreSelect = cursoDiv.querySelector('.trimestre-select');
    trimestreSelect.addEventListener('change', (e) => {
      const selectedTrim = e.target.value;
      const mesesDiv = document.getElementById(`meses-${index}`);
      mesesDiv.innerHTML = ""; // limpiar

      if (mesesPorTrimestre[selectedTrim]) {
        mesesPorTrimestre[selectedTrim].forEach((mes, mesIndex) => {
          mesesDiv.innerHTML += `
            <h4>${mes}</h4>
            <input type="hidden" name="cursos[${index}][meses][${mesIndex}][mes]" value="${mes}">

            <label>Contenidos</label>
            <select name="cursos[${index}][meses][${mesIndex}][contenidos][]" multiple>
              {{#each contenidos}}
                <option value="{{this}}">{{this}}</option>
              {{/each}}
            </select>

            <label>Perspectivas</label>
            <select name="cursos[${index}][meses][${mesIndex}][perspectivas][]" multiple>
              {{#each perspectivas}}
                <option value="{{this}}">{{this}}</option>
              {{/each}}
            </select>

            <label>Recursos</label>
            <select name="cursos[${index}][meses][${mesIndex}][recursos][]" multiple>
              {{#each recursos}}
                <option value="{{this}}">{{this}}</option>
              {{/each}}
            </select>
            <hr>
          `;
        });
      }
    });
  });
</script>
